# Technical Design: HSM Registry & Group Management

Этот документ описывает структуру и логику работы Реестра HSM, который служит базой знаний для Meta-Orchestrator.

## 1. Концепция
Реестр HSM — это структурированное описание компонентов и их взаимосвязей. Он позволяет абстрагироваться от конкретных реализаций через механизм групп. В HSM на один проект полагается **ровно один реестр**.

## 2. Структура Реестра (Registry Layout)

Реестр представляет собой директорию (по умолчанию `hsm-registry/`) со следующей структурой:

```text
hsm-registry/
├── packages/           # Манифесты Python-пакетов
├── containers/         # Манифесты Docker-контейнеров
├── package_groups/     # Группы выбора для Python-пакетов
└── container_groups/   # Группы выбора для Docker-сервисов
```

## 3. Группы и Стратегии выбора

Группы позволяют определять "интерфейсы" системы.

### 3.1. Стратегия 1-of-N (Virtual Component)
Используется для взаимоисключающих реализаций.
*   **Пример**: Выбор одной векторной БД из списка доступных.
*   **Логика**: В манифесте проекта `hsm.yaml` группе присваивается строка с именем выбранного компонента.

### 3.2. Стратегия M-of-N (Feature Set)
Используется для набора дополняющих друг друга компонентов.
*   **Пример**: Набор метрик для оценки модели.
*   **Логика**: В манифесте проекта группе присваивается список имен компонентов.

## 4. Манифесты компонентов

Каждый компонент (пакет или контейнер) описывается YAML-файлом, который содержит:
1.  **Metadata**: Имя, версия, описание.
2.  **Sources**: Ссылки на исходный код или артефакты для режимов `prod` и `dev`.
3.  **Orchestration**: (Для контейнеров) Имя сервиса в Docker Compose, порты, тома.
4.  **Dependencies**: Список других компонентов HSM или внешних библиотек.

## 5. CLI Workflow

### 5.1. Исследование (`hsm registry search`)
Пользователь ищет нужный компонент в реестре. HSM сканирует все поддиректории реестра и выводит совпадения.

### 5.2. Добавление в проект (`hsm add`)
При добавлении компонента HSM проверяет его наличие в реестре и автоматически прописывает его в нужную секцию `hsm.yaml`.

## 6. Преимущества подхода
1.  **Централизация знаний**: Все правила сборки и источники компонентов описаны в одном месте.
2.  **Гибкость**: Легко переключать реализации интерфейсов без изменения кода приложения.
3.  **Масштабируемость**: Разделение на типы (packages/containers) позволяет реестру расти без потери читаемости.