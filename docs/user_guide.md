# Руководство пользователя HPM: Реестры и Группы

HPM (HyperPackageManager) предоставляет мощный механизм управления конфигурацией проекта через абстракции групп и реестров. Это руководство поможет вам понять, как использовать эти возможности.

## 1. Концепция Реестра

Реестр — это структурированная база знаний о доступных пакетах и их логических объединениях. По умолчанию HPM ищет реестр в директории `registry/` корня проекта.

### Структура директории реестра:
- `registry/groups/`: YAML-файлы, описывающие группы (например, `inference.yaml`).
- `registry/packages/`: YAML-файлы, описывающие конкретные пакеты (например, `vlm-adapter-qwen.yaml`).

## 2. Определение Групп

Группа описывает набор взаимозаменяемых или дополняющих друг друга опций.

Пример `registry/groups/inference.yaml`:
```yaml
name: "inference"
strategy: "1-of-N" # Можно выбрать только одну опцию
options:
  - name: "vlm-adapter-qwen"
  - name: "vlm-adapter-deepseek"
```

### Стратегии:
- `1-of-N`: Взаимоисключающий выбор (Virtual Package).
- `M-of-N`: Выбор нескольких опций одновременно.

## 3. Описание Пакетов

Каждый пакет в реестре должен иметь манифест, указывающий, откуда его загрузить.

Пример `registry/packages/vlm-adapter-qwen.yaml`:
```yaml
name: "vlm-adapter-qwen"
version: "0.1.0"
sources:
  prod:
    type: "local"
    path: "../../packages/vlm_adapter"
    editable: true
```

## 4. Рабочий процесс пользователя

### Шаг 1: Выбор компонентов
Используйте команду `group add`, чтобы зафиксировать выбор в `pyproject.toml`:
```bash
hpm group add inference --option vlm-adapter-qwen
```

### Шаг 2: Проверка совместимости
HPM использует `uv lock`, чтобы убедиться, что выбранные компоненты не конфликтуют:
```bash
hpm check
```

### Шаг 3: Применение изменений
Команда `sync` материализует ваш выбор в реальные зависимости проекта:
```bash
hpm sync
```
После выполнения этой команды `uv` установит необходимые пакеты и обновит `uv.lock`.

## 5. Управление реестром из CLI

Для быстрого добавления новых пакетов в реестр используйте интерактивную команду:
```bash
hpm registry add
```
Она проведет вас через процесс создания манифеста, запросив имя пакета, тип источника и путь/URL.

## 6. Продвинутые настройки

Вы можете указать путь к реестру явно через флаг `--registry` или `-r` во всех командах:
```bash
hpm sync --registry /path/to/custom/registry