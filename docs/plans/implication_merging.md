# Архитектурный план: Implication Merging

## Цель
Реализовать механизм слияния зависимостей, позволяющий нескольким пакетам использовать один и тот же сервис с объединением их параметров (например, создание нескольких БД в одном контейнере Postgres).

## Проектируемая логика

### 1. Расширение реестра (Implies Params)
В реестре пакетов (`registry/packages/*.yaml`) секция `implies` должна поддерживать передачу параметров:
```yaml
implies:
  container:postgres:
    params:
      db_name: "auth_db"
```

### 2. Механизм слияния в HSMCore
При выполнении `sync()`, ядро должно:
1.  Собирать все `implies` от всех выбранных пакетов.
2.  Группировать их по `registry_id` сервиса.
3.  Если для одного сервиса найдено несколько наборов параметров:
    *   Объединять списки (например, `db_name` превращается в список имен).
    *   Использовать специальный синтаксис в манифесте сервиса для доступа к этим данным: `${HSM_MERGED_PARAMS.key}`.

### 3. Инъекция в Docker Compose
Адаптер контейнеров должен уметь подставлять объединенные значения в переменные окружения или команды запуска.

## Схема
```mermaid
graph LR
    PkgA[Package A] -->|implies: db_name=1| Svc[Service X]
    PkgB[Package B] -->|implies: db_name=2| Svc
    Svc --> Core[HSM Core Merging]
    Core --> Result[Single Container with DB_LIST=1,2]