# HyperPackageManager (hpm)

`HPM` — это мета-менеджер пакетов для динамических Python-сред, построенный поверх `uv`([ссылка](https://github.com/astral-sh/uv)). 

Он позволяет управлять составом зависимостей проекта, используя высокоуровневые абстракции: **Группы** и **Реестры**.

## Основные возможности

*   **Registry-driven**: Описание доступных компонентов в виде python-пакетов в YAML-реестре.

*   **Group Management**: Управление логическими группами пакетов (например, `inference`, `metrics`) вместо длинных списков пакетов.

*   **UV Integration**: Полная поддержка `uv>=0.9.26` для быстрой установки и разрешения конфликтов.

*   **Dry Run Validation**: Проверка разрешимости конфигурации без физической установки.

*   **Observability**: Удобные команды `list`, `show` и `search` для навигации по реестру и проекту.

*   **Registry Management**: Команды для интерактивного добавления новых пакетов в реестр.

## Философия и стандарты

HPM строится на базе современных стандартов индустрии:

*   **Declarative First**: Файлы конфигурации (`pyproject.toml`, YAML) являются единственным источником правды. CLI — лишь удобный инструмент для их редактирования.

*   **Infrastructure as Code (IaC)**: Состав окружения фиксируется в Git, обеспечивая воспроизводимость на любом этапе.

*   **Modern DX (Developer Experience)**:
    *   Интерактивные команды с подсказками.
    *   Визуализация состояния через `rich` (таблицы, деревья).
    *   Глубокая интеграция с `uv` — самым быстрым менеджером пакетов в экосистеме Python.

*   **Zero-Cost Abstraction**: HPM не накладывает ограничений на рантайм. После `hpm sync` ваш проект — это стандартный Python-проект, который можно запускать через `python` или `uv run`.

## Будущее проекта

Мы стремимся к созданию **единого графа знаний** о ML-системах состоящих из множества компонентов.
В таких проектах часто встречается абстрактный интерфейс, и отдельные python-пакеты реализующие этот интерфейс.

Например, абстратный интерфейс модели, и python-пакеты реализующие model_1 и model_2 по этому итерфейсу.

Благодаря `HPM` выбор python-пакета реализующего model_1 или model_2 — это простая декларативная операция, гарантирующая корректность всего стека зависимостей.

## Установка

```bash
# Внутри monorepo
uv pip install -e packages/hyper_package_manager
```

## Быстрый старт

### 1. Исследование реестра
Посмотрите доступные группы и их статус:
```bash
hpm list
```
Или найдите нужный компонент:
```bash
hpm search qwen
```

### 2. Добавление группы
Выберите конкретную реализацию для логической группы:
```bash
hpm group add inference --option vlm-adapter-qwen
```
Это добавит настройку в ваш `pyproject.toml`:
```toml
[tool.hpm.groups]
inference = "vlm-adapter-qwen"
```

### 3. Проверка (Dry Run)
Проверьте, совместимы ли выбранные пакеты:
```bash
hpm check
```

### 4. Синхронизация
Материализуйте конфигурацию в реальные зависимости:
```bash
hpm sync
```
HPM найдет `vlm-adapter-qwen` в реестре и выполнит `uv add <path_or_git_url>`.

## Управление реестром

Вы можете добавлять новые пакеты в реестр интерактивно:
```bash
hpm registry add
```
HPM предложит ввести имя, тип источника (git/local), путь и версию, после чего создаст YAML-манифест в `registry/packages/`.

## Структура реестра

Реестр — это директория с манифестами:
*   `groups/*.yaml`: Определения групп и доступных опций.
*   `packages/*.yaml`: Манифесты конкретных пакетов с указанием источников (`git`, `local`).

## Разработка

HPM Lite поддерживает установку плагинов напрямую из манифеста:
```bash
hpm install --manifest path/to/hpm.yaml --mode dev
```

