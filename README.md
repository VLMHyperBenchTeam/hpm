# Hyper Stack Manager (hsm)

`hsm` — это Meta-Orchestrator для современной разработки, выступающий в роли "Environment Hypervisor". Он позволяет декларативно собирать рабочее окружение проекта из независимых компонентов (Python-пакетов и Docker-контейнеров) на основе единого манифеста `hsm.yaml`.

HSM не заменяет существующие инструменты, а оркестрирует их через систему адаптеров (`uv`, `docker compose`), обеспечивая бесшовный переход между Dev и Prod режимами.

## Основные возможности

*   **Declarative Intent**: Файл `hsm.yaml` является единственным источником правды. Вы описываете *что* нужно, HSM решает *как* это установить.
*   **Hybrid Stack**: Одновременное управление Python-зависимостями и инфраструктурными Docker-сервисами.
*   **Atomic Sync**: Изменения применяются транзакционно. Если синхронизация не удалась, основные конфиги проекта (`pyproject.toml`, `docker-compose.yml`) остаются нетронутыми.
*   **Seamless Dev/Prod**: Переключение между "стабильными образами/пакетами" и "локальными исходниками" одной командой.
*   **LEGO Architecture**: Использование групп (1-of-N / M-of-N) для легкой подмены реализаций интерфейсов (например, смена векторной БД).

## Философия

HSM строится на базе современных стандартов индустрии:

*   **Infrastructure as Code (IaC)**: Состав всего стека фиксируется в Git.
*   **Zero-Cost Abstraction**: HSM генерирует стандартные конфиги. После синхронизации ваш проект — это обычный проект, который можно запускать стандартными средствами.
*   **Modern DX**: Единый CLI для управления всем технологическим стеком проекта.

## Установка

Рекомендуется устанавливать HSM как изолированный инструмент через `uv tool`. Это предотвратит конфликты с зависимостями ваших проектов.

### 1. Режим разработки (Editable)
Если вы планируете вносить изменения в код HSM:
```bash
uv tool install -e ./hsm
```

### 2. Режим использования (Production)
Для обычной работы с инструментом:
```bash
uv tool install ./hsm
```

## Быстрый старт

### 1. Инициализация
Создайте базовый манифест на основе текущего проекта:
```bash
hsm init
```

### 2. Добавление компонентов
Добавьте пакет или контейнер из глобального реестра:
```bash
hsm add qdrant-adapter
```

### 3. Переключение в режим разработки
Если вы хотите править код компонента локально:
```bash
hsm mode qdrant-adapter dev
```

### 4. Синхронизация
Материализуйте конфигурацию:
```bash
hsm sync
```
HSM обновит `pyproject.toml`, сгенерирует `docker-compose.hsm.yml` и вызовет `uv sync`.

## Документация

*   [Спецификация HSM](./docs/hsm_specification.md)
*   [Workflow Guide: Общий процесс](./docs/workflow_guide.md)
*   [Python Workflow Deep Dive](./docs/python_workflow.md)
*   [Docker Workflow Deep Dive](./docs/docker_workflow.md)
*   [Руководство пользователя](./docs/user_guide.md)

## Структура проекта

*   `hsm.yaml`: Манифест проекта (Source of Truth).
*   `hsm-registry/`: База знаний о доступных компонентах.
*   `pyproject.toml`: Артефакт для Python-зависимостей (управляется HSM).
*   `docker-compose.hsm.yml`: Артефакт для Docker-сервисов (управляется HSM).
